(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{7684:function(e,t,s){Promise.resolve().then(s.bind(s,729))},729:function(e,t,s){"use strict";s.r(t),s.d(t,{Experience:function(){return M}});var a=s(3827),l=s(2020);let n=["Nanami","Naoki"],r=(0,l.Ue)((e,t)=>({messages:[],currentMessage:null,teacher:n[0],setTeacher:s=>{e(()=>({teacher:s,messages:t().messages.map(e=>(e.audioPlayer=null,e))}))},classroom:"default",setClassroom:t=>{e(()=>({classroom:t}))},loading:!1,speech:"formal",setSpeech:t=>{e(()=>({speech:t}))},askAI:async s=>{if(!s)return;let a={question:s,id:t().messages.length};e(()=>({loading:!0}));let l=t().speech,n=await fetch("/api/ai?question=".concat(s,"&speech=").concat(l)),r=await n.json();a.answer=JSON.parse(r.result.candidates[0].content.parts[0].text.replace(/```json|```/g,"").trim()),a.speech=l,e(()=>({currentMessage:a})),e(e=>({messages:[...e.messages,a],loading:!1})),t().playMessage(a)},playMessage:async s=>{if(e(()=>({currentMessage:s})),!s.audioPlayer){e(()=>({loading:!0}));let a=await fetch("/api/tts?teacher=".concat(t().teacher,"&text=").concat(s.answer.text)),l=await a.blob(),n=URL.createObjectURL(l),r=new Audio(n),i=await o(l);s.visemes=i,s.audioPlayer=r,s.audioPlayer.onended=()=>{e(()=>({currentMessage:null}))},e(()=>({loading:!1,messages:t().messages.map(e=>e.id===s.id?s:e)}))}s.audioPlayer.currentTime=0,s.audioPlayer.play()},stopMessage:t=>{t.audioPlayer.pause(),e(()=>({currentMessage:null}))}})),o=async e=>new Promise((e,t)=>{e([{time:0,viseme:"a"},{time:.5,viseme:"e"},{time:1,viseme:"o"}])});var i=s(6473),c=s(2017),d=s(6959),u=s(5451),h=s(9473),m=s(7808),x=s(4435),p=s(9631),g=s(9811),f=s(4090),b=s(5511);let w=()=>{let e=r(e=>e.teacher),t=r(e=>e.setTeacher),s=r(e=>e.speech),l=r(e=>e.setSpeech),o=r(e=>e.classroom),i=r(e=>e.setClassroom);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"absolute right-0 bottom-full flex flex-row gap-10 mb-20",children:n.map((s,l)=>(0,a.jsxs)("div",{className:"p-3 transition-colors duration-500 ".concat(e===s?"bg-white/80":"bg-white/40"),children:[(0,a.jsx)("div",{onClick:()=>t(s),children:(0,a.jsx)("img",{src:"/images/".concat(s,".jpg"),alt:s,className:"object-cover w-40 h-40"})}),(0,a.jsx)("h2",{className:"text-3xl font-bold mt-3 text-center",children:s})]},l))}),(0,a.jsxs)("div",{className:"absolute left-0 bottom-full flex flex-row gap-2 mb-20",children:[(0,a.jsx)("button",{className:" ".concat("default"===o?"text-white bg-slate-900/40 ":"text-white/45 bg-slate-700/20 "," py-4 px-10 text-4xl rounded-full transition-colors duration-500 backdrop-blur-md"),onClick:()=>i("default"),children:"Default classroom"}),(0,a.jsx)("button",{className:" ".concat("alternative"===o?"text-white bg-slate-900/40 ":"text-white/45 bg-slate-700/20 "," py-4 px-10 text-4xl rounded-full transition-colors duration-500 backdrop-blur-md"),onClick:()=>i("alternative"),children:"Alternative classroom"})]}),(0,a.jsxs)("div",{className:"absolute left-0 top-full flex flex-row gap-2 mt-20",children:[(0,a.jsx)("button",{className:" ".concat("formal"===s?"text-white bg-slate-900/40 ":"text-white/45 bg-slate-700/20 "," py-4 px-10 text-4xl rounded-full transition-colors duration-500 backdrop-blur-md"),onClick:()=>l("formal"),children:"Formal"}),(0,a.jsx)("button",{className:" ".concat("casual"===s?"text-white bg-slate-900/40 ":"text-white/45 bg-slate-700/20 "," py-4 px-10 text-4xl rounded-full transition-colors duration-500 backdrop-blur-md"),onClick:()=>l("casual"),children:"Casual"})]})]})},j=()=>{let e=r(e=>e.messages),t=r(e=>e.playMessage),{currentMessage:s}=r();r(e=>e.english),r(e=>e.furigana);let l=r(e=>e.classroom),n=(0,f.useRef)();return(0,f.useEffect)(()=>{n.current.scrollTo({top:n.current.scrollHeight,behavior:"smooth"})},[e.length]),(0,a.jsxs)("div",{className:"".concat("default"===l?"w-[1288px] h-[676px]":"w-[2528px] h-[856px]"," p-8 overflow-y-auto flex flex-col space-y-8 bg-transparent opacity-80"),ref:n,children:[0===e.length&&(0,a.jsx)("div",{className:"h-full w-full grid place-content-center text-center",children:(0,a.jsxs)("h2",{className:"text-8xl font-bold text-white/90 italic",children:["AI ENGLISH TEACHER",(0,a.jsx)("br",{}),(0,a.jsx)("br",{}),"English Learning Class"]})}),e.map((e,l)=>(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("div",{className:"flex-grow",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("span",{className:"text-white/90 text-2xl font-bold uppercase px-3 py-1 rounded-full  ".concat("formal"===e.speech?"bg-indigo-600":"bg-teal-600"),children:e.speech}),(0,a.jsx)("p",{className:"text-4xl inline-block px-2 rounded-sm font-bold bg-clip-text text-transparent bg-gradient-to-br from-blue-300/90 to-white/90",children:e.answer.text})]})}),s===e?(0,a.jsx)("button",{className:"text-white/65",onClick:()=>stopMessage(e),children:(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-16 h-16",children:[(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}),(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 9.563C9 9.252 9.252 9 9.563 9h4.874c.311 0 .563.252.563.563v4.874c0 .311-.252.563-.563.563H9.564A.562.562 0 0 1 9 14.437V9.564Z"})]})}):(0,a.jsx)("button",{className:"text-white/65",onClick:()=>t(e),children:(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-16 h-16",children:[(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}),(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.91 11.672a.375.375 0 0 1 0 .656l-5.603 3.113a.375.375 0 0 1-.557-.328V8.887c0-.286.307-.466.557-.327l5.603 3.112Z"})]})})]}),""!==e.answer.grammar_mistakes&&(0,a.jsxs)("div",{className:"p-5 mt-5  bg-gradient-to-br from-pink-200/20 to-pink-500/20 rounded-xl",children:[(0,a.jsx)("span",{className:"pr-4 italic bg-clip-text text-transparent bg-gradient-to-b from-white/90 to-white/70 text-3xl font-bold uppercase inline-block",children:"Grammar Mistakes"}),(0,a.jsx)("p",{style:{fontSize:"25px",paddingTop:"10px"},children:e.answer.grammar_mistakes})]})]},l))]})};var v=s(7601),k=s(3966),y=s(6376);function N(e){let{teacher:t,...s}=e,l=(0,f.useRef)(),{scene:n}=(0,x.L)("/models/Teacher_".concat(t,".glb"));(0,f.useEffect)(()=>{n.traverse(e=>{e.material&&(e.material=new y.MeshStandardMaterial({map:e.material.map}))})},[n]);let o=r(e=>e.currentMessage),i=r(e=>e.loading),{animations:c}=(0,x.L)("/models/animations_".concat(t,".glb")),{actions:u,mixer:h}=(0,v.v)(c,l),[m,p]=(0,f.useState)("Idle"),[g,w]=(0,f.useState)(!1);(0,f.useEffect)(()=>{let e;let t=()=>{e=setTimeout(()=>{w(!0),setTimeout(()=>{w(!1),t()},100)},(0,b.rO)(1e3,5e3))};return t(),()=>clearTimeout(e)},[]),(0,f.useEffect)(()=>{i?p("Thinking"):o?p((0,b.rO)(0,1)?"Talking":"Talking2"):p("Idle")},[o,i]),(0,k.C)(e=>{let{camera:t}=e;j("mouthSmile",.2,.5),j("eye_close",g?1:0,.5);for(let e=0;e<=21;e++)j(e,0,.1);if(o&&o.visemes&&o.audioPlayer){for(let e=o.visemes.length-1;e>=0;e--){let t=o.visemes[e];if(1e3*o.audioPlayer.currentTime>=t[0]){j(t[1],1,.2);break}}u[m].time>u[m].getClip().duration-.5&&p(e=>"Talking"===e?"Talking2":"Talking")}}),(0,f.useEffect)(()=>{var e;return null===(e=u[m])||void 0===e||e.reset().fadeIn(h.time>0?.5:0).play(),()=>{var e;null===(e=u[m])||void 0===e||e.fadeOut(.5)}},[m,u]);let j=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1;n.traverse(a=>{if(a.isSkinnedMesh&&a.morphTargetDictionary){let l=a.morphTargetDictionary[e];void 0!==l&&void 0!==a.morphTargetInfluences[l]&&(a.morphTargetInfluences[l]=y.MathUtils.lerp(a.morphTargetInfluences[l],t,s))}})},[N,S]=(0,f.useState)(".");return(0,f.useEffect)(()=>{if(i){let e=setInterval(()=>{S(e=>3===e.length?".":e+".")},500);return()=>clearInterval(e)}},[i]),(0,a.jsxs)("group",{...s,dispose:null,ref:l,children:[i&&(0,a.jsx)(d.V,{"position-y":"Nanami"===t?1.6:1.8,children:(0,a.jsx)("div",{className:"flex justify-center items-center -translate-x-1/2",children:(0,a.jsxs)("span",{className:"relative flex h-8 w-8 items-center justify-center",children:[(0,a.jsx)("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-white opacity-75"}),(0,a.jsx)("span",{className:"relative inline-flex items-center justify-center duration-75 rounded-full h-8 w-8 bg-white/80",children:N})]})})}),(0,a.jsx)("primitive",{object:n})]})}n.forEach(e=>{x.L.preload("/models/Teacher_".concat(e,".glb")),x.L.preload("/models/animations_".concat(e,".glb"))});let S=()=>"SpeechRecognition"in window||"webkitSpeechRecognition"in window,C=()=>{let e;let t=r(e=>e.askAI),s=r(e=>e.loading),[l,n]=(0,f.useState)(""),[o,i]=(0,f.useState)(!1);e=S()?new(window.SpeechRecognition||window.webkitSpeechRecognition):null;let c=()=>{t(l),n("")};return(0,a.jsxs)("div",{className:"z-10 max-w-[600px] flex space-y-6 flex-col bg-gradient-to-tr from-slate-300/30 via-gray-400/30 to-slate-600-400/30 p-4 backdrop-blur-md rounded-xl border-slate-100/30 border",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-white font-bold text-xl",children:"Ask question to the AI teacher to learn English Speaking"}),(0,a.jsx)("p",{className:"text-white/65",children:"It will Communicate with you and help you to learn English better"})]}),s?(0,a.jsx)("div",{className:"flex justify-center items-center",children:(0,a.jsxs)("span",{className:"relative flex h-4 w-4",children:[(0,a.jsx)("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-white opacity-75"}),(0,a.jsx)("span",{className:"relative inline-flex rounded-full h-4 w-4 bg-white"})]})}):(0,a.jsxs)("div",{className:"gap-3 flex",children:[(0,a.jsx)("input",{className:"focus:outline focus:outline-white/80 flex-grow bg-slate-800/60 p-2 px-4 rounded-full text-white placeholder:text-white/50 shadow-inner shadow-slate-900/60",placeholder:"Ask a question?",value:l,onChange:e=>n(e.target.value),onKeyDown:e=>{"Enter"===e.key&&c()}}),(0,a.jsx)("button",{className:"bg-slate-100/20 p-2 px-6 rounded-full text-white",onClick:c,children:"Ask"}),(0,a.jsx)("button",{className:"bg-slate-100/20 p-2 rounded-full text-white ".concat(o?"bg-red-500":"bg-green-500"),onClick:o?()=>{e&&(e.stop(),i(!1))}:()=>{e?(i(!0),e.lang="en-US",e.start(),e.onresult=e=>{n(e.results[0][0].transcript)},e.onerror=e=>{console.error("Speech recognition error",e.error),i(!1)},e.onend=()=>{i(!1)}):console.log("Speech Recognition is not supported in this browser.")},children:o?"Stop":"\uD83C\uDFA4 Start"})]})]})},T={default:{classroom:{position:[.2,-1.7,-2]},teacher:{position:[-1,-1.7,-3]},board:{position:[.45,.382,-6]}},alternative:{classroom:{position:[.3,-1.7,-1.5],rotation:[0,(0,b.Id)(-90),0],scale:.4},teacher:{position:[-1,-1.7,-3]},board:{position:[1.4,.84,-8]}}},M=()=>{let e=r(e=>e.teacher),t=r(e=>e.classroom);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"z-10 md:justify-center fixed bottom-4 left-4 right-4 flex gap-3 flex-wrap justify-stretch",children:(0,a.jsx)(C,{})}),(0,a.jsx)(g.Zf,{hidden:!0}),(0,a.jsx)(i.a,{}),(0,a.jsxs)(p.Xz,{camera:{position:[0,0,1e-4]},children:[(0,a.jsx)(I,{}),(0,a.jsx)(f.Suspense,{children:(0,a.jsxs)(c.b,{speed:.5,floatIntensity:.2,rotationIntensity:.1,children:[(0,a.jsxs)(d.V,{transform:!0,...T[t].board,distanceFactor:1,children:[(0,a.jsx)(j,{}),(0,a.jsx)(w,{})]}),(0,a.jsx)(u.qA,{preset:"sunset"}),(0,a.jsx)("ambientLight",{intensity:.8,color:"pink"}),(0,a.jsx)(h.o,{src:"/models/classroom_".concat(t,".glb"),...T[t].classroom}),(0,a.jsx)(N,{teacher:e,...T[t].teacher,scale:1.5,"rotation-y":(0,b.Id)(20)},e)]})})]})]})},L={loading:[2621880610890309e-20,515037441056466e-20,9636414192870058e-20],speaking:[0,-.00000016481333940859815,9999846226827279e-20]},E={loading:1.3,speaking:2.1204819420055387},I=()=>{let e=(0,f.useRef)(),t=r(e=>e.loading),s=r(e=>e.currentMessage);return(0,f.useEffect)(()=>{var a,l,n,r;t?(null===(a=e.current)||void 0===a||a.setPosition(...L.loading,!0),null===(l=e.current)||void 0===l||l.zoomTo(E.loading,!0)):s&&(null===(n=e.current)||void 0===n||n.setPosition(...L.speaking,!0),null===(r=e.current)||void 0===r||r.zoomTo(E.speaking,!0))},[t]),(0,g.M4)("Helper",{getCameraPosition:(0,g.LI)(()=>{console.log([...e.current.getPosition()],e.current.camera.zoom)})}),(0,a.jsx)(m.B,{ref:e,minZoom:1,maxZoom:3,polarRotateSpeed:-.3,azimuthRotateSpeed:-.3,mouseButtons:{left:1,wheel:16},touches:{one:32,two:512}})};x.L.preload("/models/classroom_default.glb"),x.L.preload("/models/classroom_alternative.glb")}},function(e){e.O(0,[689,800,300,971,69,744],function(){return e(e.s=7684)}),_N_E=e.O()}]);