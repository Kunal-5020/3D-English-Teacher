(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{2095:function(e,t,s){Promise.resolve().then(s.bind(s,729))},729:function(e,t,s){"use strict";s.r(t),s.d(t,{Experience:function(){return C}});var a=s(3827),n=s(2020);let l=["Nanami","Naoki"],r=(0,n.Ue)((e,t)=>({messages:[],currentMessage:null,teacher:l[0],setTeacher:s=>{e(()=>({teacher:s,messages:t().messages.map(e=>(e.audioPlayer=null,e))}))},classroom:"default",Language:"English",setLanguage:t=>{e(()=>({Language:t}))},loading:!1,speech:"formal",setSpeech:t=>{e(()=>({speech:t}))},askAI:async s=>{if(!s)return;let a={question:s,id:t().messages.length};e(()=>({loading:!0}));let n=t().speech,l=await fetch("/api/ai?question=".concat(s,"&speech=").concat(n)),r=await l.json();a.answer=r.result,a.speech=n,e(()=>({currentMessage:a})),e(e=>({messages:[...e.messages,a],loading:!1})),t().playMessage(a)},playMessage:async s=>{if(e(()=>({currentMessage:s})),!s.audioPlayer){e(()=>({loading:!0}));let a=await fetch("/api/tts?teacher=".concat(t().teacher,"&text=").concat(s.answer.text,"&language=").concat(t().Language)),n=await a.blob(),l=URL.createObjectURL(n),r=new Audio(l),o=await i(n);s.visemes=o,s.audioPlayer=r,s.audioPlayer.onended=()=>{e(()=>({currentMessage:null}))},e(()=>({loading:!1,messages:t().messages.map(e=>e.id===s.id?s:e)}))}s.audioPlayer.currentTime=0,s.audioPlayer.play()},stopMessage:t=>{t.audioPlayer.pause(),e(()=>({currentMessage:null}))}})),i=async e=>new Promise((e,t)=>{e([{time:0,viseme:"a"},{time:.5,viseme:"e"},{time:1,viseme:"o"}])});var o=s(6473),c=s(2017),d=s(6959),u=s(5451),m=s(9473),h=s(7808),x=s(4435),g=s(9631),p=s(9811),f=s(4090),b=s(5511);let w=()=>{let e=r(e=>e.teacher),t=r(e=>e.setTeacher),s=r(e=>e.speech),n=r(e=>e.setSpeech),i=r(e=>e.Language),o=r(e=>e.setLanguage);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"absolute right-0 bottom-full flex flex-row gap-10 mb-20",children:l.map((s,n)=>(0,a.jsxs)("div",{className:"p-3 transition-colors duration-500 ".concat(e===s?"bg-white/80":"bg-white/40"),children:[(0,a.jsx)("div",{onClick:()=>t(s),children:(0,a.jsx)("img",{src:"/images/".concat(s,".jpg"),alt:s,className:"object-cover w-40 h-40"})}),(0,a.jsx)("h2",{className:"text-3xl font-bold mt-3 text-center text-black",children:s})]},n))}),(0,a.jsxs)("div",{className:"absolute left-0 bottom-full flex flex-row gap-2 mb-20",children:[(0,a.jsx)("button",{className:"".concat("English"===i?"text-white bg-slate-900/40":"text-white/45 bg-slate-700/20"," py-4 px-10 text-4xl rounded-full transition-colors duration-500 backdrop-blur-md"),onClick:()=>o("English"),children:"English"}),(0,a.jsx)("button",{className:"".concat("Hindi"===i?"text-white bg-slate-900/40":"text-white/45 bg-slate-700/20"," py-4 px-10 text-4xl rounded-full transition-colors duration-500 backdrop-blur-md"),onClick:()=>o("Hindi"),children:"Hindi"})]}),(0,a.jsxs)("div",{className:"absolute left-0 top-full flex flex-row gap-2 mt-20",children:[(0,a.jsx)("button",{className:"".concat("formal"===s?"text-white bg-slate-900/40":"text-white/45 bg-slate-700/20"," py-4 px-10 text-4xl rounded-full transition-colors duration-500 backdrop-blur-md"),onClick:()=>n("formal"),children:"Formal"}),(0,a.jsx)("button",{className:"".concat("casual"===s?"text-white bg-slate-900/40":"text-white/45 bg-slate-700/20"," py-4 px-10 text-4xl rounded-full transition-colors duration-500 backdrop-blur-md"),onClick:()=>n("casual"),children:"Casual"})]})]})},j=()=>{let e=r(e=>e.messages),t=r(e=>e.playMessage),{currentMessage:s}=r();r(e=>e.english),r(e=>e.furigana);let n=r(e=>e.classroom),l=(0,f.useRef)();return(0,f.useEffect)(()=>{l.current.scrollTo({top:l.current.scrollHeight,behavior:"smooth"})},[e.length]),(0,a.jsxs)("div",{className:"".concat("default"===n?"w-[1288px] h-[676px]":"w-[2528px] h-[856px]"," p-8 overflow-y-auto flex flex-col space-y-8 bg-transparent opacity-80"),ref:l,children:[0===e.length&&(0,a.jsx)("div",{className:"h-full w-full grid place-content-center text-center",children:(0,a.jsxs)("h2",{className:"text-8xl font-bold text-white/90 italic",children:["AI ENGLISH TEACHER",(0,a.jsx)("br",{}),(0,a.jsx)("br",{}),"English Learning Class"]})}),e.map((e,n)=>(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("div",{className:"flex-grow",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("span",{className:"text-white/90 text-2xl font-bold uppercase px-3 py-1 rounded-full  ".concat("formal"===e.speech?"bg-indigo-600":"bg-teal-600"),children:e.speech}),(0,a.jsx)("p",{className:"text-4xl inline-block px-2 rounded-sm font-bold bg-clip-text text-transparent bg-gradient-to-br from-blue-300/90 to-white/90",children:e.answer.text})]})}),s===e?(0,a.jsx)("button",{className:"text-white/65",onClick:()=>stopMessage(e),children:(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-16 h-16",children:[(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}),(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 9.563C9 9.252 9.252 9 9.563 9h4.874c.311 0 .563.252.563.563v4.874c0 .311-.252.563-.563.563H9.564A.562.562 0 0 1 9 14.437V9.564Z"})]})}):(0,a.jsx)("button",{className:"text-white/65",onClick:()=>t(e),children:(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-16 h-16",children:[(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}),(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.91 11.672a.375.375 0 0 1 0 .656l-5.603 3.113a.375.375 0 0 1-.557-.328V8.887c0-.286.307-.466.557-.327l5.603 3.112Z"})]})})]}),""!==e.answer.grammar_mistakes&&(0,a.jsxs)("div",{className:"p-5 mt-5  bg-gradient-to-br from-pink-200/20 to-pink-500/20 rounded-xl",children:[(0,a.jsx)("span",{className:"pr-4 italic bg-clip-text text-transparent bg-gradient-to-b from-white/90 to-white/70 text-3xl font-bold uppercase inline-block",children:"Grammar Mistakes"}),(0,a.jsx)("p",{style:{fontSize:"25px",paddingTop:"10px"},children:e.answer.grammar_mistakes})]})]},n))]})};var v=s(7601),k=s(3966),y=s(6376);function N(e){let{teacher:t,...s}=e,n=(0,f.useRef)(),{scene:l}=(0,x.L)("/models/Teacher_".concat(t,".glb"));(0,f.useEffect)(()=>{l.traverse(e=>{e.material&&(e.material=new y.MeshStandardMaterial({map:e.material.map}))})},[l]);let i=r(e=>e.currentMessage),o=r(e=>e.loading),{animations:c}=(0,x.L)("/models/animations_".concat(t,".glb")),{actions:u,mixer:m}=(0,v.v)(c,n),[h,g]=(0,f.useState)("Idle"),[p,w]=(0,f.useState)(!1);(0,f.useEffect)(()=>{let e;let t=()=>{e=setTimeout(()=>{w(!0),setTimeout(()=>{w(!1),t()},100)},(0,b.rO)(1e3,5e3))};return t(),()=>clearTimeout(e)},[]),(0,f.useEffect)(()=>{o?g("Thinking"):i?g((0,b.rO)(0,1)?"Talking":"Talking2"):g("Idle")},[i,o]),(0,k.C)(e=>{let{camera:t}=e;j("mouthSmile",.2,.5),j("eye_close",p?1:0,.5);for(let e=0;e<=21;e++)j(e,0,.1);if(i&&i.visemes&&i.audioPlayer){for(let e=i.visemes.length-1;e>=0;e--){let t=i.visemes[e];if(1e3*i.audioPlayer.currentTime>=t[0]){j(t[1],1,.2);break}}u[h].time>u[h].getClip().duration-.5&&g(e=>"Talking"===e?"Talking2":"Talking")}}),(0,f.useEffect)(()=>{var e;return null===(e=u[h])||void 0===e||e.reset().fadeIn(m.time>0?.5:0).play(),()=>{var e;null===(e=u[h])||void 0===e||e.fadeOut(.5)}},[h,u]);let j=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1;l.traverse(a=>{if(a.isSkinnedMesh&&a.morphTargetDictionary){let n=a.morphTargetDictionary[e];void 0!==n&&void 0!==a.morphTargetInfluences[n]&&(a.morphTargetInfluences[n]=y.MathUtils.lerp(a.morphTargetInfluences[n],t,s))}})},[N,T]=(0,f.useState)(".");return(0,f.useEffect)(()=>{if(o){let e=setInterval(()=>{T(e=>3===e.length?".":e+".")},500);return()=>clearInterval(e)}},[o]),(0,a.jsxs)("group",{...s,dispose:null,ref:n,children:[o&&(0,a.jsx)(d.V,{"position-y":"Nanami"===t?1.6:1.8,children:(0,a.jsx)("div",{className:"flex justify-center items-center -translate-x-1/2",children:(0,a.jsxs)("span",{className:"relative flex h-8 w-8 items-center justify-center",children:[(0,a.jsx)("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-white opacity-75"}),(0,a.jsx)("span",{className:"relative inline-flex items-center justify-center duration-75 rounded-full h-8 w-8 bg-white/80",children:N})]})})}),(0,a.jsx)("primitive",{object:l})]})}l.forEach(e=>{x.L.preload("/models/Teacher_".concat(e,".glb")),x.L.preload("/models/animations_".concat(e,".glb"))});let T=()=>"SpeechRecognition"in window||"webkitSpeechRecognition"in window,L=()=>{let e=r(e=>e.askAI),t=r(e=>e.loading),[s,n]=(0,f.useState)(""),[l,i]=(0,f.useState)(!1),o=(0,f.useRef)(null);(0,f.useEffect)(()=>{T()&&(o.current=new(window.SpeechRecognition||window.webkitSpeechRecognition),o.current.lang="en-IN")},[]);let c=()=>{""!==s.trim()&&(e(s),n(""))};return(0,a.jsx)("div",{className:"z-10 w-full max-w-[800px] flex flex-col space-y-4 bg-gradient-to-tr from-slate-300/30 via-gray-400/30 to-slate-600/30 p-4 backdrop-blur-md rounded-lg border border-slate-100/30 shadow-md",children:t?(0,a.jsx)("div",{className:"flex justify-center items-center",children:(0,a.jsxs)("span",{className:"relative flex h-5 w-5",children:[(0,a.jsx)("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-white opacity-75"}),(0,a.jsx)("span",{className:"relative inline-flex rounded-full h-5 w-5 bg-white"})]})}):(0,a.jsxs)("div",{className:"flex flex-col md:flex-row gap-3",children:[(0,a.jsx)("input",{className:"flex-grow bg-slate-800/60 p-2 rounded-lg text-white placeholder:text-white/50 shadow-inner focus:outline focus:outline-white/80 text-sm",placeholder:"Ask a question?",value:s,onChange:e=>n(e.target.value),onKeyDown:e=>{"Enter"===e.key&&c()}}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{className:"bg-slate-100/20 p-2 rounded-lg text-white text-sm ".concat(""===s.trim()?"opacity-50 cursor-not-allowed":""),onClick:c,disabled:""===s.trim(),children:"Ask"}),(0,a.jsx)("button",{className:"p-2 rounded-lg text-white text-sm ".concat(l?"bg-red-500":"bg-green-500"),onClick:l?()=>{o.current&&(o.current.stop(),i(!1))}:()=>{if(!o.current){alert("Speech Recognition is not supported in this browser.");return}i(!0),o.current.start(),o.current.onresult=e=>{n(e.results[0][0].transcript)},o.current.onerror=e=>{console.error("Speech recognition error",e.error),alert("An error occurred during speech recognition. Please try again."),i(!1)},o.current.onend=()=>{i(!1),""!==s.trim()&&c()}},children:l?"Stop":"\uD83C\uDFA4 Start"})]})]})})},S={default:{classroom:{position:[.2,-1.7,-2]},teacher:{position:[-1,-1.7,-3]},board:{position:[.45,.382,-6]}}},C=()=>{let e=r(e=>e.teacher),t=r(e=>e.classroom);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"z-10 md:justify-center fixed bottom-4 left-4 right-4 flex gap-3 flex-wrap justify-stretch",children:(0,a.jsx)(L,{})}),(0,a.jsx)(p.Zf,{hidden:!0}),(0,a.jsx)(o.a,{}),(0,a.jsxs)(g.Xz,{camera:{position:[0,0,1e-4]},children:[(0,a.jsx)(I,{}),(0,a.jsx)(f.Suspense,{children:(0,a.jsxs)(c.b,{speed:.5,floatIntensity:.2,rotationIntensity:.1,children:[(0,a.jsxs)(d.V,{transform:!0,...S[t].board,distanceFactor:1,children:[(0,a.jsx)(j,{}),(0,a.jsx)(w,{})]}),(0,a.jsx)(u.qA,{preset:"sunset"}),(0,a.jsx)("ambientLight",{intensity:.8,color:"pink"}),(0,a.jsx)(m.o,{src:"/models/classroom_".concat(t,".glb"),...S[t].classroom}),(0,a.jsx)(N,{teacher:e,...S[t].teacher,scale:1.5,"rotation-y":(0,b.Id)(20)},e)]})})]})]})},E={loading:[2621880610890309e-20,515037441056466e-20,9636414192870058e-20],speaking:[0,-.00000016481333940859815,9999846226827279e-20]},M={loading:1.3,speaking:2.1204819420055387},I=()=>{let e=(0,f.useRef)(),t=r(e=>e.loading),s=r(e=>e.currentMessage);return(0,f.useEffect)(()=>{var a,n,l,r;t?(null===(a=e.current)||void 0===a||a.setPosition(...E.loading,!0),null===(n=e.current)||void 0===n||n.zoomTo(M.loading,!0)):s&&(null===(l=e.current)||void 0===l||l.setPosition(...E.speaking,!0),null===(r=e.current)||void 0===r||r.zoomTo(M.speaking,!0))},[t]),(0,p.M4)("Helper",{getCameraPosition:(0,p.LI)(()=>{console.log([...e.current.getPosition()],e.current.camera.zoom)})}),(0,a.jsx)(h.B,{ref:e,minZoom:1,maxZoom:3,polarRotateSpeed:-.3,azimuthRotateSpeed:-.3,mouseButtons:{left:1,wheel:16},touches:{one:32,two:512}})};x.L.preload("/models/classroom_default.glb")}},function(e){e.O(0,[689,800,300,971,69,744],function(){return e(e.s=2095)}),_N_E=e.O()}]);